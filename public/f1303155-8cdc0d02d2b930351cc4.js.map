{"version":3,"sources":["webpack://they-work-for-us/./src/components/viz/scoreViz.js"],"names":["cssTimeLine","display","media","width","cssCloseBtn","zIndex","position","top","right","height","cursor","opacity","content","backgroundColor","transform","cssTimeLineCon","cssLollipopCon","overflowX","background","marginTop","overflowY","borderRadius","cssLabel","textAlign","fontSize","marginBottom","left","cssLabelCon","pointerEvents","cssScoreText","cssTooltipStyle","boxShadow","padding","p","a","textDecoration","color","cssLineCon","alignItems","margin","cssLine","typeColor","d3","prepareData","senateVoteData","meanScore","d","acc","criteriaScore","fGrade","senator","dGrade","cGrade","bGrade","labelGradeData","grade","score","posScore","Math","meanPos","CreateLabel","gradeObj","css","props","placeholder","useStaticQuery","filter","timelineRef","useRef","lollipopRef","useState","tooltip","setTooltip","tooltipStyle","setTooltipStyle","useEffect","placeholderImage","miniWidth","mainWidth","mainMargin","maxWidth","brushWidth","brush","newXcor","timelineSvg","xTimeline","data","yTimeline","miniBar","pos","lolliSvg","gBrush","selection","size","range","x0","x1","dx","topSection","xLolli","i","yLolli","strokeType","strokeWidth","tooltipTop","tooltipLeft","window","overflow","createChart","updateChart","setScrolling","scrollTop","setScrollTop","currentPosition","id","href","target","rel","stroke","y1","x2","y2","ref","className","key","index"],"mappings":"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","file":"f1303155-8cdc0d02d2b930351cc4.js","sourcesContent":["import React, { useRef, useEffect, useState } from \"react\"\nimport { media } from \"../../styles\"\nimport * as d3 from \"d3\"\nimport { useStaticQuery, graphql } from \"gatsby\"\nimport _ from \"lodash\"\n\nconst cssTimeLine = {\n  display: \"none\",\n  [media(767)]: {\n    width: \"100%\",\n    display: \"flex\",\n  },\n}\n\nconst cssCloseBtn = {\n  zIndex: \"100\",\n  position: \"absolute\",\n  top: \"0.5rem\",\n  right: \"0.5rem\",\n  width: \"10px\",\n  height: \"10px\",\n  cursor: \"pointer\",\n  opacity: \"0.5\",\n  [media(767)]: {\n    right: \"0.5rem\",\n  },\n  \"&:hover\": {\n    opacity: \"1\",\n  },\n  \"&:before, &:after\": {\n    position: \"absolute\",\n    top: \"0\",\n    right: \"1.2rem\",\n    content: '\"\"',\n    height: \"12px\",\n    width: \"1px\",\n    backgroundColor: \"black\",\n  },\n  \"&:before\": {\n    transform: \"rotate(45deg)\",\n  },\n  \"&:after\": {\n    transform: \"rotate(-45deg)\",\n  },\n}\n\nconst cssTimeLineCon = {\n  display: \"none\",\n  [media(767)]: {\n    width: \"100%\",\n    display: \"flex\",\n    position: \"relative\",\n  },\n}\n\nconst cssLollipopCon = {\n  overflowX: \"scroll\",\n  background: \"rgba(238,240,144, 0.1)\",\n  [media(767)]: {\n    height: \"43.6rem\",\n    marginTop: \"2.6rem\",\n    overflowY: \"hidden\",\n    position: \"relative\",\n  },\n  \"::-webkit-scrollbar-track\": {\n    background: \"#DFDFDF\",\n  },\n  \"::-webkit-scrollbar\": {\n    height: 7,\n    background: \"#DFDFDF\",\n  },\n  \"::-webkit-scrollbar-thumb\": {\n    background: \"#F0324B\",\n    borderRadius: 6,\n  },\n}\n\nconst cssLabel = {\n  width: \"7.6rem\",\n  height: \"2.4rem\",\n  borderRadius: \"0.3rem\",\n  position: \"relative\",\n  background: \"#EEF090\",\n  textAlign: \"center\",\n  fontSize: \"1.4rem\",\n  marginBottom: \"0.8rem\",\n  zIndex: 9,\n  left: 0,\n}\n\nconst cssLabelCon = {\n  height: \"39.4rem\",\n  width: \"24rem\",\n  position: \"sticky\",\n  marginTop: \"-34rem\",\n  left: 0,\n  zIndex: 150,\n  pointerEvents: \"none\",\n}\n\nconst cssScoreText = {\n  fontSize: \"1.2rem\",\n}\n\nconst cssTooltipStyle = {\n  position: \"fixed\",\n  width: \"20.6rem\",\n  background: \"#fff\",\n  boxShadow: \"0px 1px 4px rgba(0, 0, 0, 0.25)\",\n  borderRadius: \"0.4rem\",\n  padding: \"1.2rem\",\n  zIndex: 99999,\n  p: {\n    fontSize: \"1.2rem\",\n    marginBottom: \"0.4rem\",\n  },\n  a: {\n    textDecoration: \"underline\",\n    fontSize: \"1rem\",\n    color: \"#999C00\",\n  },\n}\n\nconst cssLineCon = {\n  position: \"sticky\",\n  width: \"100%\",\n  left: 0,\n  display: \"flex\",\n  alignItems: \"center\",\n  p: {\n    fontSize: \"1rem\",\n    margin: 0,\n    padding: 0,\n  },\n  zIndex: \"100\",\n}\n\nconst cssLine = {\n  width: \"100%\",\n  height: \"0.1rem\",\n}\n\nconst type = [\"โดยตำแหน่ง\", \"เลือกโดย คสช.\", \"เลือกกันเอง\"]\nconst typeColor = d3\n  .scaleOrdinal()\n  .domain(type)\n  .range([\"#999C00\", \"#5739AC\", \"#FEACAC\"])\n\nfunction prepareData(senateVoteData) {\n  const meanScore =\n    senateVoteData.map(d => d.score).reduce((acc, cur) => acc + cur, 0) /\n    senateVoteData.length\n  const criteriaScore = [50, 60, 70, 80]\n  const fGrade = senateVoteData.filter(senator => senator.score < 50).length\n  const dGrade = senateVoteData.filter(\n    senator => senator.score > 50 && senator.score < 60\n  ).length\n  const cGrade = senateVoteData.filter(\n    senator => senator.score > 60 && senator.score < 70\n  ).length\n  const bGrade = senateVoteData.filter(\n    senator => senator.score > 70 && senator.score < 80\n  ).length\n  const aGrade = senateVoteData.filter(senator => senator.score > 80).length\n  const labelGradeData = [\n    { grade: \"A\", score: aGrade },\n    { grade: \"B\", score: bGrade },\n    { grade: \"C\", score: cGrade },\n    { grade: \"D\", score: dGrade },\n    { grade: \"F\", score: fGrade },\n  ]\n  const posScore = criteriaScore.map(score => {\n    return senateVoteData.findIndex(d => Math.floor(d.score) === score)\n  })\n  const meanPos = senateVoteData.filter(\n    d => Math.floor(d.score) === Math.floor(meanScore)\n  )[0].id\n  return {\n    criteriaScore,\n    posScore,\n    meanPos,\n    labelGradeData,\n  }\n}\n\nfunction createChart(\n  data,\n  timelineRef,\n  lollipopRef,\n  setTooltip,\n  setTooltipStyle,\n  placeholder\n) {\n  const { criteriaScore, posScore, meanPos } = prepareData(data)\n  const placeholderImage = _.get(\n    placeholder,\n    \"placeholderImage.childImageSharp.fluid.src\"\n  )\n  const miniHeight = 88\n  const miniWidth = timelineRef.current.clientWidth\n\n  const mainHeight = 394\n  const mainWidth = lollipopRef.current.clientWidth\n  const mainMargin = {\n    left: 20,\n    right: 20,\n    bottom: 16,\n    top: 34,\n  }\n  const maxWidth = 12000\n\n  const brushWidth = (mainWidth / maxWidth) * miniWidth\n\n  function brushmove() {\n    const extentX = d3.event.selection\n    const newXcor = -extentX[0] * (maxWidth / mainWidth)\n    d3.select(lollipopRef.current).style(\n      \"transform\",\n      `translate(${newXcor}px,0px)`\n    )\n  }\n\n  function scroll() {\n    const gBrush = d3.select(\".brush\")\n    let selection = d3.brushSelection(gBrush.node())\n    let size = selection[1] - selection[0],\n      range = xTimeline.range(),\n      x0 = d3.min(range),\n      x1 = d3.max(range),\n      dx = -d3.event.deltaX,\n      topSection\n\n    if (selection[0] - dx < x0) {\n      topSection = x0\n    } else if (selection[1] - dx > x1) {\n      topSection = x1 - size\n    } else {\n      topSection = selection[0] - dx\n    }\n    d3.event.stopPropagation()\n    d3.event.preventDefault()\n    gBrush.call(brush.move, [topSection, topSection + size])\n  }\n\n  const brush = d3\n    .brushX()\n    .extent([\n      [0, 0],\n      [miniWidth, miniHeight],\n    ])\n    .on(\"brush\", brushmove)\n\n  const timelineSvg = d3\n    .select(timelineRef.current)\n    .append(\"svg\")\n    .attr(\"width\", miniWidth)\n    .attr(\"height\", miniHeight)\n    .style(\"pointer-events\", \"none\")\n\n  const xTimeline = d3\n    .scaleBand()\n    .domain(\n      data.map(function(d) {\n        return d.id\n      })\n    )\n    .range([0, miniWidth])\n    .padding(0.2)\n\n  timelineSvg\n    .append(\"g\")\n    .attr(\"class\", \"brush\")\n    .call(brush)\n    .call(brush.move, [0, brushWidth])\n\n  const yTimeline = d3\n    .scaleLinear()\n    .domain([0, 100])\n    .range([miniHeight, 0])\n\n  const miniBar = timelineSvg\n    .selectAll(\"timelineBar\")\n    .data(data)\n    .enter()\n  miniBar\n    .append(\"rect\")\n    .attr(\"class\", \"miniBar\")\n    .attr(\"x\", function(d) {\n      return xTimeline(d.id)\n    })\n    .attr(\"y\", function(d) {\n      return yTimeline(d.score)\n    })\n    .attr(\"width\", xTimeline.bandwidth())\n    .attr(\"height\", function(d) {\n      return miniHeight - yTimeline(d.score)\n    })\n    .attr(\"fill\", function(d) {\n      return typeColor(d.senator_method)\n    })\n\n  d3.selectAll(\".handle\").style(\"pointer-events\", \"none\")\n  d3.select(\".overlay\").style(\"pointer-events\", \"none\")\n\n  // let sumPos = 0\n  posScore.forEach(pos => {\n    if (pos === -1) return\n    timelineSvg\n      .append(\"line\")\n      .attr(\"x1\", xTimeline(data[pos].id))\n      .attr(\"x2\", xTimeline(data[pos].id))\n      .attr(\"y1\", 0)\n      .attr(\"y2\", 88)\n      .attr(\"stroke\", \"#AEAEAE\")\n      .attr(\"stroke-dasharray\", \"4\")\n\n    // const leftPos = sumPos + xTimeline(data[pos].id) / 2\n    // const legend = document.createElement(\"p\")\n    // legend.innerText = \"A\"\n    // legend.style.cssText = `position: absolute; top: 0; left: ${leftPos}px`\n    // document.getElementById(\"timeline-viz\").appendChild(legend)\n    // sumPos += xTimeline(data[pos].id)\n  })\n\n  timelineSvg\n    .append(\"line\")\n    .attr(\"x1\", xTimeline(meanPos))\n    .attr(\"x2\", xTimeline(meanPos))\n    .attr(\"y1\", 0)\n    .attr(\"y2\", 88)\n    .attr(\"stroke\", \"#F0324B\")\n\n  const lolliSvg = d3\n    .select(lollipopRef.current)\n    .append(\"svg\")\n    .attr(\"height\", mainHeight + mainMargin.top)\n    .attr(\"width\", maxWidth)\n    .on(\"wheel.zoom\", scroll)\n\n  const xLolli = d3\n    .scaleBand()\n    .domain(data.map(d => d.id))\n    .range([0, maxWidth])\n    .paddingInner(0.9)\n    .paddingOuter(0.5)\n\n  lolliSvg\n    .append(\"g\")\n    .attr(\"transform\", `translate(0,378)`)\n    .call(\n      d3\n        .axisBottom(xLolli)\n        .tickSizeOuter(0)\n        .tickSizeInner(0)\n        .tickFormat(function(_, i) {\n          return i + 1\n        })\n    )\n\n  const yLolli = d3\n    .scaleLinear()\n    .domain([0, 100])\n    .range([mainHeight, mainMargin.top + 40])\n\n  lolliSvg\n    .selectAll(\"group\")\n    .data(data)\n    .enter()\n    .append(\"g\")\n    .attr(\"class\", \"group\")\n    .append(\"rect\")\n    .attr(\"class\", \"lolliBar\")\n    .attr(\"x\", function(d) {\n      return xLolli(d.id)\n    })\n    .attr(\"y\", function(d) {\n      return yLolli(d.score) - mainMargin.bottom\n    })\n    .attr(\"width\", xLolli.bandwidth())\n    .attr(\"height\", function(d) {\n      return mainHeight - yLolli(d.score)\n    })\n    .attr(\"fill\", function(d) {\n      return typeColor(d.senator_method)\n    })\n\n  d3.selectAll(\".group\")\n    .append(\"text\")\n    .attr(\"class\", \"percentText\")\n    .attr(\"x\", function(d) {\n      return xLolli(d.id) - 5\n    })\n    .attr(\"y\", function(d) {\n      return yLolli(d.score) - mainMargin.bottom - 20 - 30\n    })\n    .attr(\"fill\", \"#828282\")\n    .attr(\"font-size\", \"1.2rem\")\n    .attr(\"dominant-baseline\", \"middle\")\n    // .attr(\"text-anchor\", \"middle\")\n    .text(function(d) {\n      return `${d.score.toFixed(0)}%`\n    })\n\n  d3.select(\".selection\")\n    .attr(\"fill\", \"#EEF090\")\n    .attr(\"stroke-width\", 1)\n    .attr(\"stroke\", \"rgba(0,0,0,0.2)\")\n    .attr(\"z-index\", 9999999)\n\n  criteriaScore.forEach((score, i) => {\n    const strokeType = score === 100 ? \"stroke-width\" : \"stroke-dasharray\"\n    const strokeWidth = score === 100 ? 1 : 0.5\n    lolliSvg\n      .append(\"line\")\n      .attr(\"x1\", 0)\n      .attr(\"x2\", maxWidth)\n      .attr(\"y1\", yLolli(score) - mainMargin.bottom)\n      .attr(\"y2\", yLolli(score) - mainMargin.bottom)\n      .attr(\"stroke\", \"#AEAEAE\")\n      .attr(strokeType, \"2\")\n      .attr(\"stroke-width\", strokeWidth)\n  })\n  d3.selectAll(\".group\")\n    .append(\"svg:defs\")\n    .append(\"svg:pattern\")\n    .attr(\"id\", function(_, i) {\n      return \"profile\" + i\n    })\n    .attr(\"width\", 40)\n    .attr(\"height\", 40)\n    .attr(\"patternUnits\", \"userSpaceOnUse\")\n    .append(\"svg:image\")\n    .attr(\"xlink:href\", function(d) {\n      return `https://elect.thematter.co/data/politicians/${\n        d.name\n      }-${d.lastname.replace(/ /g, \"-\")}.jpg`\n    })\n    .on(\"error\", function(d) {\n      d3.select(this).attr(\"xlink:href\", placeholderImage)\n    })\n    .attr(\"fluid\", placeholder.placeholderImage.childImageSharp.gatsbyImageData)\n    .attr(\"width\", 40)\n    .attr(\"height\", 40)\n    .attr(\"x\", 0)\n    .attr(\"y\", 0)\n\n  d3.selectAll(\".group\")\n    .append(\"circle\")\n    .attr(\"class\", d => `circle${d.id}`)\n    .attr(\"transform\", function(d) {\n      const x = xLolli(d.id) - 20 + xLolli.bandwidth() / 2\n      const y = yLolli(d.score) - mainMargin.bottom - 40\n      return `translate(${x}, ${y})`\n    })\n    .attr(\"cx\", 20)\n    .attr(\"cy\", 20)\n    .attr(\"r\", 20)\n    .style(\"fill\", \"#fff\")\n    .style(\"fill\", function(_, i) {\n      return \"url(#profile\" + i + \")\"\n    })\n    .style(\"cursor\", \"pointer\")\n    .attr(\"stroke\", \"black\")\n    .attr(\"stroke-width\", 1)\n    .on(\"mouseover\", function(d) {\n      d3.selectAll(\"circle\").attr(\"stroke-width\", 1)\n      d3.select(`.circle${d.id}`).attr(\"stroke-width\", 2)\n      const tooltipTop = d3.event.clientY - mainMargin.bottom - 120\n      const tooltipLeft =\n        d3.event.clientX + 250 > window.innerWidth\n          ? d3.event.clientX - 200\n          : d3.event.clientX + 10\n      setTooltip(d)\n      setTooltipStyle({\n        ...cssTooltipStyle,\n        top: tooltipTop,\n        left: tooltipLeft,\n        overflow: \"hidden\",\n        opacity: 1,\n      })\n    })\n    .on(\"click\", function(d) {\n      d3.select(\"#closeBtn\").on(\"click\", function() {\n        d3.select(`.circle${d.id}`).attr(\"stroke-width\", 1)\n        setTooltipStyle({\n          width: 0,\n          height: 0,\n          top: null,\n          left: null,\n          opacity: 0,\n        })\n      })\n    })\n}\n\nfunction updateChart(filter) {\n  if (filter === \"โดยตำแหน่ง\") {\n    d3.selectAll(\".group\").style(\"opacity\", function(d) {\n      return filter !== d.senator_method ? \"0.1\" : \"1\"\n    })\n    d3.selectAll(\".miniBar\").style(\"opacity\", function(d) {\n      return filter !== d.senator_method ? \"0.1\" : \"1\"\n    })\n  } else if (filter === \"เลือกโดย คสช.\") {\n    d3.selectAll(\".group\").style(\"opacity\", function(d) {\n      return filter !== d.senator_method ? \"0.1\" : \"1\"\n    })\n    d3.selectAll(\".miniBar\").style(\"opacity\", function(d) {\n      return filter !== d.senator_method ? \"0.1\" : \"1\"\n    })\n  } else if (filter === \"เลือกกันเอง\") {\n    d3.selectAll(\".group\").style(\"opacity\", function(d) {\n      return filter !== d.senator_method ? \"0.1\" : \"1\"\n    })\n    d3.selectAll(\".miniBar\").style(\"opacity\", function(d) {\n      return filter !== d.senator_method ? \"0.1\" : \"1\"\n    })\n  } else {\n    d3.selectAll(\".group\").style(\"opacity\", function(d) {\n      return \"1\"\n    })\n    d3.selectAll(\".miniBar\").style(\"opacity\", function(d) {\n      return \"1\"\n    })\n  }\n}\n\nfunction CreateLabel({ gradeObj }) {\n  return (\n    <div css={{ ...cssLabel }}>\n      <strong>{gradeObj.grade}</strong>{\" \"}\n      <span css={{ ...cssScoreText }}>{gradeObj.score} คน</span>\n    </div>\n  )\n}\n\nconst ScoreViz = props => {\n  const placeholder = useStaticQuery(graphql`\n    {\n      placeholderImage: file(\n        relativePath: { eq: \"images/people/placeholder.png\" }\n      ) {\n        childImageSharp {\n          gatsbyImageData(width: 84, layout: CONSTRAINED)\n        }\n      }\n    }\n  `)\n  const { senateVoteData, filter } = props\n  const { labelGradeData } = prepareData(senateVoteData)\n  const timelineRef = useRef(null)\n  const lollipopRef = useRef(null)\n\n  const [tooltip, setTooltip] = useState(null)\n  const [tooltipStyle, setTooltipStyle] = useState({\n    position: \"absolute\",\n    width: 0,\n    left: null,\n    top: null,\n    opacity: 0,\n  })\n\n  useEffect(() => {\n    createChart(\n      senateVoteData,\n      timelineRef,\n      lollipopRef,\n      setTooltip,\n      setTooltipStyle,\n      placeholder\n    )\n  }, [])\n\n  useEffect(() => {\n    updateChart(filter)\n  }, [filter])\n\n  const [scrolling, setScrolling] = useState(false)\n  const [scrollTop, setScrollTop] = useState(0)\n  useEffect(() => {\n    function onScroll() {\n      let currentPosition = window.pageYOffset // or use document.documentElement.scrollTop;\n      if (currentPosition > scrollTop) {\n        // downscroll code\n        setScrolling(false)\n      } else {\n        // upscroll code\n        setScrolling(true)\n      }\n      setScrollTop(currentPosition <= 0 ? 0 : currentPosition)\n    }\n\n    setTooltipStyle({\n      position: \"absolute\",\n      width: 0,\n      height: 0,\n      top: null,\n      left: null,\n      opacity: 0,\n    })\n\n    window.addEventListener(\"scroll\", _.throttle(onScroll, 10000))\n    return window.addEventListener(\"scroll\", _.throttle(onScroll, 10000))\n  }, [scrollTop])\n\n  return (\n    <div>\n      {tooltip ? (\n        <div css={{ ...tooltipStyle }}>\n          <div css={{ ...cssCloseBtn }} id=\"closeBtn\" />\n          <strong>\n            <p>\n              {tooltip.title} {tooltip.name} {tooltip.lastname}\n            </p>\n          </strong>\n          <p>ระยะเวลาทำงาน 145 ครั้ง</p>\n          <p>เข้าลงมติ {tooltip.votelog} ครั้ง</p>\n          <a\n            href={`https://theyworkforus.elect.in.th/people/${\n              tooltip.name\n            }-${tooltip.lastname.replace(/ /g, \"-\")}`}\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n            css={{ display: \"flex\", alignItems: \"center\" }}\n          >\n            ดูโปรไฟล์\n            <svg css={{ width: 10, height: 10, fill: \"none\", marginLeft: 8 }}>\n              <path\n                d=\"M2.49999 1.66663H0.833328V9.16663H8.33333V7.49996\"\n                stroke=\"#999C00\"\n              />\n              <line\n                x1=\"8.68688\"\n                y1=\"1.18693\"\n                x2=\"3.68688\"\n                y2=\"6.18693\"\n                stroke=\"#999C00\"\n              />\n              <path d=\"M5 0.833374H9.16667V5.00004\" stroke=\"#999C00\" />\n            </svg>\n          </a>\n        </div>\n      ) : (\n        <></>\n      )}\n      <div css={{ ...cssTimeLineCon }} id=\"timeline-viz\">\n        <div ref={timelineRef} css={{ ...cssTimeLine }} />\n      </div>\n      <div css={{ ...cssLollipopCon }} className=\"senate_scroll\">\n        <div css={{ ...cssLineCon, top: \"8rem\", pointerEvents: \"none\" }}>\n          <div css={{ ...cssLine, background: \"#AEAEAE\" }} />\n          <p\n            css={{\n              width: \"20rem\",\n              textAlign: \"center\",\n              fontWeight: \"700\",\n              color: \"#AEAEAE\",\n              background: \"rgba(255,255,255,0.8)\",\n              borderRadius: \"0.3rem\",\n            }}\n          >\n            คะแนนเต็ม 100%\n          </p>\n          <div css={{ ...cssLine, background: \"#AEAEAE\" }} />\n        </div>\n        <div css={{ ...cssLineCon, top: \"16rem\", pointerEvents: \"none\" }}>\n          <div css={{ ...cssLine, background: \"#F0324B\" }} />\n          <p\n            css={{\n              width: \"20rem\",\n              textAlign: \"center\",\n              color: \"#F0324B\",\n              fontWeight: \"700\",\n              background: \"rgba(255,255,255,0.8)\",\n              borderRadius: \"0.3rem\",\n            }}\n          >\n            คะแนนเฉลี่ย 75%\n          </p>\n          <div css={{ ...cssLine, background: \"#F0324B\" }} />\n        </div>\n        <div ref={lollipopRef} />\n        <div css={{ ...cssLabelCon }}>\n          {labelGradeData.map((gradeObj, index) => {\n            return <CreateLabel gradeObj={gradeObj} key={index} />\n          })}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nexport default ScoreViz\n"],"sourceRoot":""}